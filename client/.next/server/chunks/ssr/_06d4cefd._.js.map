{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 7, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/dibuj/Documents/Voaya/client/src/config/api.ts"],"sourcesContent":["// Usar variable de entorno o detectar dinámicamente\r\nexport const getApiUrl = (): string => {\r\n    // Primero intenta usar la variable de entorno para flexibilidad\r\n    if (process.env.NEXT_PUBLIC_API_URL) {\r\n        return process.env.NEXT_PUBLIC_API_URL;\r\n    }\r\n\r\n    // En el lado del servidor (SSR) o en desarrollo local, apunta a localhost\r\n    if (typeof window === 'undefined' || window.location.hostname === 'localhost') {\r\n        return 'http://localhost:3001/api';\r\n    }\r\n\r\n    // En producción (cuando se accede a través de un dominio), usa una ruta relativa\r\n    // para que las peticiones se dirijan al mismo host que sirve la app Next.js.\r\n    // Next.js se encargará de actuar como proxy para estas peticiones.\r\n    return '/api';\r\n};\r\n\r\nexport const API_URL = getApiUrl();\r\n\r\n\r\n\r\nconsole.log('[API Config] API_URL:', API_URL);\r\n"],"names":[],"mappings":"AAAA,oDAAoD;;;;;AAC7C,MAAM,YAAY;IACrB,gEAAgE;IAChE,IAAI,QAAQ,GAAG,CAAC,mBAAmB,EAAE;QACjC,OAAO,QAAQ,GAAG,CAAC,mBAAmB;IAC1C;IAEA,0EAA0E;IAC1E,wCAA+E;QAC3E,OAAO;IACX;;AAMJ;AAEO,MAAM,UAAU;AAIvB,QAAQ,GAAG,CAAC,yBAAyB","debugId":null}},
    {"offset": {"line": 31, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/dibuj/Documents/Voaya/client/src/services/api.ts"],"sourcesContent":["import { ChatMessage, TravelBrief, TravelPlan } from '@/types';\r\nimport { API_URL } from '@/config/api';\r\n\r\nexport class ApiService {\r\n    private static async fetchApi(endpoint: string, options: RequestInit = {}) {\r\n        const url = `${API_URL}${endpoint}`;\r\n        try {\r\n            console.log(`[ApiService] Fetching ${url}`, { method: options.method });\r\n\r\n            const response = await fetch(url, {\r\n                ...options,\r\n                headers: {\r\n                    'Content-Type': 'application/json',\r\n                    ...options.headers,\r\n                },\r\n            });\r\n\r\n            console.log(`[ApiService] Response received with status: ${response.status}`);\r\n\r\n            if (!response.ok) {\r\n                const errorText = await response.text();\r\n                console.error(`[ApiService] API error: ${response.status}`, errorText);\r\n                throw new Error(`API error: ${response.status} - ${errorText}`);\r\n            }\r\n\r\n            const responseText = await response.text();\r\n            console.log(`[ApiService] Raw response text:`, responseText);\r\n\r\n            try {\r\n                const data = JSON.parse(responseText);\r\n                console.log(`[ApiService] Parsed response:`, data);\r\n                return data;\r\n            } catch (error) {\r\n                console.error(`[ApiService] Error parsing JSON:`, error);\r\n                // Si el parseo falla, pero la respuesta fue exitosa (ej. 204 No Content),\r\n                // podríamos devolver un objeto vacío o el texto plano si es necesario.\r\n                return { success: true, data: responseText };\r\n            }\r\n        } catch (error: any) {\r\n            console.error(`[ApiService] Fetch error:`, error);\r\n            throw error;\r\n        }\r\n    } static async startChat(userId: string, categories: string[] = []) {\r\n        return this.fetchApi('/chat/start', {\r\n            method: 'POST',\r\n            body: JSON.stringify({ userId, categories }),\r\n        });\r\n    }\r\n\r\n    static async sendMessage(chatId: string, text: string, userId: string) {\r\n        return this.fetchApi('/chat/message', {\r\n            method: 'POST',\r\n            body: JSON.stringify({ chatId, text, userId }),\r\n        });\r\n    }\r\n\r\n    static async completeChat(chatId: string) {\r\n        return this.fetchApi('/chat/complete', {\r\n            method: 'POST',\r\n            body: JSON.stringify({ chatId }),\r\n        });\r\n    }\r\n\r\n    static async getChats(userId?: string) {\r\n        const qs = userId ? `?userId=${encodeURIComponent(userId)}` : '';\r\n        return this.fetchApi(`/chat${qs}`, {\r\n            method: 'GET'\r\n        });\r\n    }\r\n\r\n    static async getChat(chatId: string) {\r\n        if (!chatId) throw new Error('chatId required');\r\n        return this.fetchApi(`/chat/${encodeURIComponent(chatId)}`, {\r\n            method: 'GET'\r\n        });\r\n    }\r\n\r\n    static async sendToExternal(chatId: string, webhookUrl?: string) {\r\n        return this.fetchApi('/chat/send-external', {\r\n            method: 'POST',\r\n            body: JSON.stringify({ chatId, webhookUrl }),\r\n        });\r\n    }\r\n\r\n    static async generatePlan(brief: TravelBrief, userLocation: GeolocationPosition | null) {\r\n        return this.fetchApi('/chat/generate-plan', {\r\n            method: 'POST',\r\n            body: JSON.stringify({ brief, userLocation }),\r\n        }) as Promise<TravelPlan>;\r\n    }\r\n}"],"names":[],"mappings":";;;AACA;;AAEO,MAAM;IACT,aAAqB,SAAS,QAAgB,EAAE,UAAuB,CAAC,CAAC,EAAE;QACvE,MAAM,MAAM,GAAG,8HAAA,CAAA,UAAO,GAAG,UAAU;QACnC,IAAI;YACA,QAAQ,GAAG,CAAC,CAAC,sBAAsB,EAAE,KAAK,EAAE;gBAAE,QAAQ,QAAQ,MAAM;YAAC;YAErE,MAAM,WAAW,MAAM,MAAM,KAAK;gBAC9B,GAAG,OAAO;gBACV,SAAS;oBACL,gBAAgB;oBAChB,GAAG,QAAQ,OAAO;gBACtB;YACJ;YAEA,QAAQ,GAAG,CAAC,CAAC,4CAA4C,EAAE,SAAS,MAAM,EAAE;YAE5E,IAAI,CAAC,SAAS,EAAE,EAAE;gBACd,MAAM,YAAY,MAAM,SAAS,IAAI;gBACrC,QAAQ,KAAK,CAAC,CAAC,wBAAwB,EAAE,SAAS,MAAM,EAAE,EAAE;gBAC5D,MAAM,IAAI,MAAM,CAAC,WAAW,EAAE,SAAS,MAAM,CAAC,GAAG,EAAE,WAAW;YAClE;YAEA,MAAM,eAAe,MAAM,SAAS,IAAI;YACxC,QAAQ,GAAG,CAAC,CAAC,+BAA+B,CAAC,EAAE;YAE/C,IAAI;gBACA,MAAM,OAAO,KAAK,KAAK,CAAC;gBACxB,QAAQ,GAAG,CAAC,CAAC,6BAA6B,CAAC,EAAE;gBAC7C,OAAO;YACX,EAAE,OAAO,OAAO;gBACZ,QAAQ,KAAK,CAAC,CAAC,gCAAgC,CAAC,EAAE;gBAClD,0EAA0E;gBAC1E,uEAAuE;gBACvE,OAAO;oBAAE,SAAS;oBAAM,MAAM;gBAAa;YAC/C;QACJ,EAAE,OAAO,OAAY;YACjB,QAAQ,KAAK,CAAC,CAAC,yBAAyB,CAAC,EAAE;YAC3C,MAAM;QACV;IACJ;IAAE,aAAa,UAAU,MAAc,EAAE,aAAuB,EAAE,EAAE;QAChE,OAAO,IAAI,CAAC,QAAQ,CAAC,eAAe;YAChC,QAAQ;YACR,MAAM,KAAK,SAAS,CAAC;gBAAE;gBAAQ;YAAW;QAC9C;IACJ;IAEA,aAAa,YAAY,MAAc,EAAE,IAAY,EAAE,MAAc,EAAE;QACnE,OAAO,IAAI,CAAC,QAAQ,CAAC,iBAAiB;YAClC,QAAQ;YACR,MAAM,KAAK,SAAS,CAAC;gBAAE;gBAAQ;gBAAM;YAAO;QAChD;IACJ;IAEA,aAAa,aAAa,MAAc,EAAE;QACtC,OAAO,IAAI,CAAC,QAAQ,CAAC,kBAAkB;YACnC,QAAQ;YACR,MAAM,KAAK,SAAS,CAAC;gBAAE;YAAO;QAClC;IACJ;IAEA,aAAa,SAAS,MAAe,EAAE;QACnC,MAAM,KAAK,SAAS,CAAC,QAAQ,EAAE,mBAAmB,SAAS,GAAG;QAC9D,OAAO,IAAI,CAAC,QAAQ,CAAC,CAAC,KAAK,EAAE,IAAI,EAAE;YAC/B,QAAQ;QACZ;IACJ;IAEA,aAAa,QAAQ,MAAc,EAAE;QACjC,IAAI,CAAC,QAAQ,MAAM,IAAI,MAAM;QAC7B,OAAO,IAAI,CAAC,QAAQ,CAAC,CAAC,MAAM,EAAE,mBAAmB,SAAS,EAAE;YACxD,QAAQ;QACZ;IACJ;IAEA,aAAa,eAAe,MAAc,EAAE,UAAmB,EAAE;QAC7D,OAAO,IAAI,CAAC,QAAQ,CAAC,uBAAuB;YACxC,QAAQ;YACR,MAAM,KAAK,SAAS,CAAC;gBAAE;gBAAQ;YAAW;QAC9C;IACJ;IAEA,aAAa,aAAa,KAAkB,EAAE,YAAwC,EAAE;QACpF,OAAO,IAAI,CAAC,QAAQ,CAAC,uBAAuB;YACxC,QAAQ;YACR,MAAM,KAAK,SAAS,CAAC;gBAAE;gBAAO;YAAa;QAC/C;IACJ;AACJ","debugId":null}},
    {"offset": {"line": 140, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/dibuj/Documents/Voaya/client/src/app/chats/page.tsx"],"sourcesContent":["\r\n\"use client\";\r\nimport React, { useEffect, useState } from 'react';\r\nimport { getUserIdFromCookie, saveChatIdToCookie } from '@/lib/cookies';\r\nimport { ApiService } from '@/services/api';\r\nimport { useRouter } from 'next/navigation';\r\n\r\ntype ChatItem = {\r\n  id: string;\r\n  title?: string;\r\n  status?: string;\r\n  lastMessageAt?: any;\r\n  metadata?: any;\r\n};\r\n\r\nconst statusColors: Record<string, string> = {\r\n  'En proceso': 'bg-yellow-100 text-yellow-800',\r\n  'Finalizado': 'bg-green-100 text-green-800',\r\n};\r\n\r\nexport default function ChatsPage() {\r\n  const router = useRouter();\r\n  const [chats, setChats] = useState<ChatItem[]>([]);\r\n  const [loading, setLoading] = useState(true);\r\n  const [error, setError] = useState<string | null>(null);\r\n\r\n  useEffect(() => {\r\n    const load = async () => {\r\n      setLoading(true);\r\n      try {\r\n        const userId = getUserIdFromCookie() || undefined;\r\n        const res: any = await ApiService.getChats(userId);\r\n        setChats(res?.chats || []);\r\n      } catch (err: any) {\r\n        console.error('Failed to load chats', err);\r\n        setError(err?.message || 'Error cargando chats');\r\n      } finally {\r\n        setLoading(false);\r\n      }\r\n    };\r\n    load();\r\n  }, []);\r\n\r\n  return (\r\n    <main className=\"min-h-screen bg-gray-50 py-8 px-4\">\r\n      <h1 className=\"text-3xl font-bold mb-6 text-gray-900\">Mis Chats</h1>\r\n\r\n      {loading && <div className=\"text-gray-600\">Cargando chats…</div>}\r\n      {error && <div className=\"text-red-600\">{error}</div>}\r\n\r\n      {!loading && !error && (\r\n        <div className=\"grid gap-6 md:grid-cols-2 lg:grid-cols-3\">\r\n          {chats.length === 0 && (\r\n            <div className=\"text-gray-600\">No tienes chats todavía. Inicia una conversación desde el planificador.</div>\r\n          )}\r\n\r\n          {chats.map(chat => (\r\n            <button\r\n              key={chat.id}\r\n              onClick={() => {\r\n                try {\r\n                  saveChatIdToCookie(chat.id);\r\n                } catch (e) {\r\n                  console.error('Failed to save chatId cookie', e);\r\n                }\r\n                router.push(`/chats/${chat.id}`);\r\n              }}\r\n              className=\"text-left rounded-lg shadow-md bg-white p-6 flex flex-col justify-between hover:shadow-lg transition-shadow\"\r\n            >\r\n              <div>\r\n                <h2 className=\"text-lg font-semibold text-gray-800 mb-2\">{chat.title || 'Sin título'}</h2>\r\n                <span\r\n                  className={`inline-block px-3 py-1 rounded-full text-sm font-medium mb-2 ${statusColors[chat.status || 'Finalizado']}`}\r\n                >\r\n                  {chat.status || 'Finalizado'}\r\n                </span>\r\n              </div>\r\n              <div className=\"mt-4 text-xs text-gray-500\">ID: {chat.id}</div>\r\n            </button>\r\n          ))}\r\n        </div>\r\n      )}\r\n    </main>\r\n  );\r\n}\r\n// ...existing code...\r\n"],"names":[],"mappings":";;;;AAEA;AACA;AACA;AACA;AAJA;;;;;;AAcA,MAAM,eAAuC;IAC3C,cAAc;IACd,cAAc;AAChB;AAEe,SAAS;IACtB,MAAM,SAAS,CAAA,GAAA,kIAAA,CAAA,YAAS,AAAD;IACvB,MAAM,CAAC,OAAO,SAAS,GAAG,CAAA,GAAA,qMAAA,CAAA,WAAQ,AAAD,EAAc,EAAE;IACjD,MAAM,CAAC,SAAS,WAAW,GAAG,CAAA,GAAA,qMAAA,CAAA,WAAQ,AAAD,EAAE;IACvC,MAAM,CAAC,OAAO,SAAS,GAAG,CAAA,GAAA,qMAAA,CAAA,WAAQ,AAAD,EAAiB;IAElD,CAAA,GAAA,qMAAA,CAAA,YAAS,AAAD,EAAE;QACR,MAAM,OAAO;YACX,WAAW;YACX,IAAI;gBACF,MAAM,SAAS,CAAA,GAAA,+HAAA,CAAA,sBAAmB,AAAD,OAAO;gBACxC,MAAM,MAAW,MAAM,gIAAA,CAAA,aAAU,CAAC,QAAQ,CAAC;gBAC3C,SAAS,KAAK,SAAS,EAAE;YAC3B,EAAE,OAAO,KAAU;gBACjB,QAAQ,KAAK,CAAC,wBAAwB;gBACtC,SAAS,KAAK,WAAW;YAC3B,SAAU;gBACR,WAAW;YACb;QACF;QACA;IACF,GAAG,EAAE;IAEL,qBACE,8OAAC;QAAK,WAAU;;0BACd,8OAAC;gBAAG,WAAU;0BAAwC;;;;;;YAErD,yBAAW,8OAAC;gBAAI,WAAU;0BAAgB;;;;;;YAC1C,uBAAS,8OAAC;gBAAI,WAAU;0BAAgB;;;;;;YAExC,CAAC,WAAW,CAAC,uBACZ,8OAAC;gBAAI,WAAU;;oBACZ,MAAM,MAAM,KAAK,mBAChB,8OAAC;wBAAI,WAAU;kCAAgB;;;;;;oBAGhC,MAAM,GAAG,CAAC,CAAA,qBACT,8OAAC;4BAEC,SAAS;gCACP,IAAI;oCACF,CAAA,GAAA,+HAAA,CAAA,qBAAkB,AAAD,EAAE,KAAK,EAAE;gCAC5B,EAAE,OAAO,GAAG;oCACV,QAAQ,KAAK,CAAC,gCAAgC;gCAChD;gCACA,OAAO,IAAI,CAAC,CAAC,OAAO,EAAE,KAAK,EAAE,EAAE;4BACjC;4BACA,WAAU;;8CAEV,8OAAC;;sDACC,8OAAC;4CAAG,WAAU;sDAA4C,KAAK,KAAK,IAAI;;;;;;sDACxE,8OAAC;4CACC,WAAW,CAAC,6DAA6D,EAAE,YAAY,CAAC,KAAK,MAAM,IAAI,aAAa,EAAE;sDAErH,KAAK,MAAM,IAAI;;;;;;;;;;;;8CAGpB,8OAAC;oCAAI,WAAU;;wCAA6B;wCAAK,KAAK,EAAE;;;;;;;;2BAnBnD,KAAK,EAAE;;;;;;;;;;;;;;;;;AA0B1B,EACA,sBAAsB","debugId":null}},
    {"offset": {"line": 287, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/dibuj/Documents/Voaya/node_modules/next/navigation.js"],"sourcesContent":["module.exports = require('./dist/client/components/navigation')\n"],"names":[],"mappings":"AAAA,OAAO,OAAO","ignoreList":[0],"debugId":null}}]
}