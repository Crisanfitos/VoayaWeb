"use strict";exports.id=768,exports.ids=[768],exports.modules={27549:(e,t,s)=>{s.d(t,{G:()=>a});let r=process.env.NEXT_PUBLIC_API_URL?process.env.NEXT_PUBLIC_API_URL:"http://localhost:3001";console.log("[API Config] API_URL:",r);class a{static async fetchApi(e,t={}){let s=`${r}${e}`;try{console.log(`[ApiService] Fetching ${s}`,{method:t.method});let e=await fetch(s,{...t,headers:{"Content-Type":"application/json",...t.headers}});if(console.log(`[ApiService] Response received with status: ${e.status}`),!e.ok){let t=await e.text();throw console.error(`[ApiService] API error: ${e.status}`,t),Error(`API error: ${e.status} - ${t}`)}let r=await e.text();console.log("[ApiService] Raw response text:",r);try{let e=JSON.parse(r);return console.log("[ApiService] Parsed response:",e),e}catch(e){return console.error("[ApiService] Error parsing JSON:",e),{success:!0,data:r}}}catch(e){throw console.error("[ApiService] Fetch error:",e),e}}static async startChat(e,t=[]){return this.fetchApi("/chat/start",{method:"POST",body:JSON.stringify({userId:e,categories:t})})}static async sendMessage(e,t,s){return this.fetchApi("/chat/message",{method:"POST",body:JSON.stringify({chatId:e,text:t,userId:s})})}static async completeChat(e){return this.fetchApi("/chat/complete",{method:"POST",body:JSON.stringify({chatId:e})})}static async getChats(e){let t=e?`?userId=${encodeURIComponent(e)}`:"";return this.fetchApi(`/chat${t}`,{method:"GET"})}static async getChat(e){if(!e)throw Error("chatId required");return this.fetchApi(`/chat/${encodeURIComponent(e)}`,{method:"GET"})}static async sendToExternal(e,t){return this.fetchApi("/chat/send-external",{method:"POST",body:JSON.stringify({chatId:e,webhookUrl:t})})}static async generatePlan(e,t){return this.fetchApi("/chat/generate-plan",{method:"POST",body:JSON.stringify({brief:e,userLocation:t})})}}},65155:(e,t,s)=>{s.d(t,{A:()=>n});var r=s(28625),a=s(64996),o=s(27549),i=s(17618);let n=({onChatComplete:e,error:t,initialQuery:s,selectedCategories:n,initialMessages:l,initialStatus:d})=>{let[c,h]=(0,a.useState)(()=>l||[]),[u,g]=(0,a.useState)(""),[m,f]=(0,a.useState)(!1),[x,p]=(0,a.useState)(!!d&&"completed"===d),[b,w]=(0,a.useState)(s||""),y=(0,a.useRef)(null),v=(0,a.useRef)(!1),j=(0,i.VV)(),N=(0,i.AA)();(0,a.useEffect)(()=>{console.log("[ChatView] Initialized with initialStatus:",d),console.log("[ChatView] Initial messages count:",c.length);let e=d&&("completed"===d||"finished"===d||"active"===d&&c.length>0);console.log("[ChatView] shouldShowComplete:",e),e&&!x&&p(!0)},[d,c.length,x]);let C=(0,a.useCallback)(async e=>{if(console.log(`[ChatView] sendMessage called with: "${e}"`),console.log(`[ChatView] userId: ${j}, chatId: ${N}`),!j||!N){console.error("[ChatView] Missing userId or chatId from cookies"),h(e=>[...e,{role:"assistant",text:"Error: No se pudo identificar tu sesi\xf3n. Por favor, inicia sesi\xf3n de nuevo."}]);return}f(!0);try{console.log("[ChatView] Calling ApiService.sendMessage...");let t=await o.G.sendMessage(N,e,j);if(console.log("[ChatView] Received response from API:",t),!t.message||"string"!=typeof t.message.text)throw console.error("[ChatView] Invalid response structure:",t),Error("Invalid response structure from server");let s={role:"assistant",text:t.message.text};console.log("[ChatView] Updating messages state with new message..."),h(e=>{let t=[...e,s];return console.log("[ChatView] New messages state:",t),t}),s.text.includes("ya tengo una base muy s\xf3lida para empezar a buscar")&&(console.log("[ChatView] Chat completion detected from Gemini response."),p(!0))}catch(e){console.error("[ChatView] Error calling API:",e),h(e=>[...e,{role:"assistant",text:"Lo siento, estoy teniendo problemas para conectarme. Por favor, int\xe9ntalo de nuevo."}])}finally{console.log("[ChatView] sendMessage finished."),f(!1)}},[n]),S=async e=>{if(e.preventDefault(),!u.trim()||m)return;let t={role:"user",text:u};h(e=>[...e,t]),g(""),b||w(u),await C(u)};(0,a.useEffect)(()=>{s&&!v.current&&(h([{role:"user",text:s}]),w(s),C(s),v.current=!0)},[s,C]);let A=async()=>{if(N)try{console.log("[ChatView] Marking chat as completed..."),await o.G.completeChat(N),console.log("[ChatView] Chat marked as completed")}catch(e){console.error("[ChatView] Error completing chat:",e)}window.location.href="/plan"};return(0,r.jsxs)("div",{className:"container max-w-4xl mx-auto flex flex-col min-h-[700px] bg-gradient-to-b from-white to-gray-50/80 rounded-3xl shadow-xl overflow-hidden border border-gray-100/80",children:[(0,r.jsx)("div",{className:"py-8 px-8 bg-white border-b border-gray-100/80",children:(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{className:"space-y-1",children:[(0,r.jsx)("h1",{className:"text-2xl font-semibold bg-gradient-to-r from-blue-600 to-indigo-600 bg-clip-text text-transparent",children:"Tu pr\xf3xima aventura te espera ✈️"}),(0,r.jsx)("p",{className:"text-sm text-gray-500",children:"Charlemos sobre tu pr\xf3ximo viaje"})]}),(0,r.jsxs)("div",{className:"flex items-center gap-2 px-4 py-2 bg-gray-50 rounded-full border border-gray-100/80",children:[(0,r.jsx)("div",{className:"w-2 h-2 rounded-full bg-green-400 animate-pulse"}),(0,r.jsx)("span",{className:"text-sm text-gray-600 font-medium",children:"Voaya est\xe1 activa"})]})]})}),t&&(0,r.jsx)("div",{className:"px-8 py-3 bg-red-50 border-b border-red-100 text-red-600 text-center text-sm font-medium",children:t}),(0,r.jsxs)("div",{className:"flex-1 overflow-y-auto px-8 py-8 space-y-8",children:[c.map((e,t)=>(0,r.jsxs)("div",{className:`flex items-end gap-4 ${"user"===e.role?"justify-end":"justify-start"} animate-slideIn`,children:["assistant"===e.role&&(0,r.jsx)("div",{className:"w-12 h-12 rounded-full bg-gradient-to-br from-blue-600 to-indigo-600 flex items-center justify-center text-white font-bold text-lg shadow-inner flex-shrink-0 border-2 border-white",children:"V"}),(0,r.jsx)("div",{className:`
                group max-w-[80%] px-6 py-4 rounded-2xl transition-all duration-200
                ${"user"===e.role?"bg-gradient-to-r from-blue-600 to-indigo-600 text-white rounded-br-sm shadow-lg hover:shadow-xl hover:-translate-y-0.5":"bg-white text-gray-700 rounded-bl-sm shadow-md hover:shadow-lg hover:-translate-y-0.5 border border-gray-100"}
              `,children:(0,r.jsx)("p",{className:"text-[15px] leading-relaxed whitespace-pre-wrap",children:e.text})})]},t)),m&&(0,r.jsxs)("div",{className:"flex items-end gap-4 justify-start animate-slideIn",children:[(0,r.jsx)("div",{className:"w-10 h-10 rounded-full bg-gradient-to-br from-blue-600 to-indigo-600 flex items-center justify-center text-white font-bold text-lg shadow-inner flex-shrink-0 border-2 border-white",children:"V"}),(0,r.jsx)("div",{className:"max-w-[80%] px-5 py-4 rounded-2xl bg-white shadow-md border border-gray-100 rounded-bl-sm",children:(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,r.jsx)("div",{className:"w-2.5 h-2.5 rounded-full bg-blue-500 animate-bounce"}),(0,r.jsx)("div",{className:"w-2.5 h-2.5 rounded-full bg-blue-500 animate-bounce [animation-delay:0.2s]"}),(0,r.jsx)("div",{className:"w-2.5 h-2.5 rounded-full bg-blue-500 animate-bounce [animation-delay:0.4s]"})]})})]}),(0,r.jsx)("div",{ref:y})]}),(0,r.jsx)("div",{className:"p-8 bg-white border-t border-gray-100/80",children:x?(0,r.jsxs)("div",{className:"flex items-center justify-center gap-6",children:[(0,r.jsx)("button",{onClick:()=>{h([]),g(""),f(!1),p(!1),w("")},className:"px-8 py-4 rounded-full bg-gray-50 text-gray-700 font-medium hover:bg-gray-100 transition-all duration-300 transform hover:-translate-y-0.5 focus:outline-none focus:ring-2 focus:ring-gray-200 focus:ring-offset-2 shadow-sm hover:shadow",children:"Reiniciar Chat"}),(0,r.jsx)("button",{onClick:A,className:"px-10 py-4 rounded-full bg-gradient-to-r from-blue-600 to-indigo-600 text-white font-medium hover:from-blue-700 hover:to-indigo-700 transition-all duration-300 transform hover:-translate-y-0.5 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 shadow-md hover:shadow-lg",children:"Confirmar y Buscar"})]}):(0,r.jsxs)("form",{onSubmit:S,className:"flex items-center gap-4",children:[(0,r.jsx)("div",{className:"relative flex-1",children:(0,r.jsx)("input",{type:"text",value:u,onChange:e=>g(e.target.value),placeholder:"Ej.: Par\xeds, 2 personas, mayo...",className:"w-full px-6 py-4 bg-gray-50 text-gray-800 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition-all duration-200 placeholder:text-gray-400 shadow-sm hover:shadow-md",disabled:m})}),(0,r.jsx)("button",{type:"submit",disabled:m||!u.trim(),className:"p-4 rounded-xl bg-gradient-to-r from-blue-600 to-indigo-600 text-white hover:from-blue-700 hover:to-indigo-700 disabled:from-gray-300 disabled:to-gray-300 disabled:cursor-not-allowed transition-all duration-300 transform hover:-translate-y-0.5 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 shadow-md hover:shadow-lg",children:(0,r.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",viewBox:"0 0 20 20",fill:"currentColor",children:(0,r.jsx)("path",{d:"M10.894 2.553a1 1 0 00-1.788 0l-7 14a1 1 0 001.169 1.409l5-1.429A1 1 0 009 15.571V11a1 1 0 112 0v4.571a1 1 0 00.725.962l5 1.428a1 1 0 001.17-1.408l-7-14z"})})})]})})]})}},94638:(e,t,s)=>{s.r(t),s.d(t,{default:()=>a});var r=s(41808);let a=async e=>[{type:"image/x-icon",sizes:"16x16",url:(0,r.fillMetadataSegment)(".",await e.params,"favicon.ico")+""}]}};