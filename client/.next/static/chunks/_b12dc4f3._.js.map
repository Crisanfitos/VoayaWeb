{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 7, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/dibuj/Documents/Voaya/client/src/config/api.ts"],"sourcesContent":["// Usar variable de entorno o detectar dinámicamente\r\nexport const getApiUrl = (): string => {\r\n    // Primero intenta usar la variable de entorno para flexibilidad\r\n    if (process.env.NEXT_PUBLIC_API_URL) {\r\n        return process.env.NEXT_PUBLIC_API_URL;\r\n    }\r\n\r\n    // En el lado del servidor (SSR) o en desarrollo local, apunta a localhost\r\n    if (typeof window === 'undefined' || window.location.hostname === 'localhost') {\r\n        return 'http://localhost:3001/api';\r\n    }\r\n\r\n    // En producción (cuando se accede a través de un dominio), usa una ruta relativa\r\n    // para que las peticiones se dirijan al mismo host que sirve la app Next.js.\r\n    // Next.js se encargará de actuar como proxy para estas peticiones.\r\n    return '/api';\r\n};\r\n\r\nexport const API_URL = getApiUrl();\r\n\r\n\r\n\r\nconsole.log('[API Config] API_URL:', API_URL);\r\n"],"names":[],"mappings":"AAAA,oDAAoD;;;;;AAG5C;AAFD,MAAM,YAAY;IACrB,gEAAgE;IAChE,IAAI,gKAAA,CAAA,UAAO,CAAC,GAAG,CAAC,mBAAmB,EAAE;QACjC,OAAO,gKAAA,CAAA,UAAO,CAAC,GAAG,CAAC,mBAAmB;IAC1C;IAEA,0EAA0E;IAC1E,IAAI,aAAkB,eAAe,OAAO,QAAQ,CAAC,QAAQ,KAAK,aAAa;QAC3E,OAAO;IACX;IAEA,iFAAiF;IACjF,6EAA6E;IAC7E,mEAAmE;IACnE,OAAO;AACX;AAEO,MAAM,UAAU;AAIvB,QAAQ,GAAG,CAAC,yBAAyB","debugId":null}},
    {"offset": {"line": 38, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/dibuj/Documents/Voaya/client/src/services/api.ts"],"sourcesContent":["import { ChatMessage, TravelBrief, TravelPlan } from '@/types';\r\nimport { API_URL } from '@/config/api';\r\n\r\nexport class ApiService {\r\n    private static async fetchApi(endpoint: string, options: RequestInit = {}) {\r\n        const url = `${API_URL}${endpoint}`;\r\n        try {\r\n            console.log(`[ApiService] Fetching ${url}`, { method: options.method });\r\n\r\n            const response = await fetch(url, {\r\n                ...options,\r\n                headers: {\r\n                    'Content-Type': 'application/json',\r\n                    ...options.headers,\r\n                },\r\n            });\r\n\r\n            console.log(`[ApiService] Response received with status: ${response.status}`);\r\n\r\n            if (!response.ok) {\r\n                const errorText = await response.text();\r\n                console.error(`[ApiService] API error: ${response.status}`, errorText);\r\n                throw new Error(`API error: ${response.status} - ${errorText}`);\r\n            }\r\n\r\n            const responseText = await response.text();\r\n            console.log(`[ApiService] Raw response text:`, responseText);\r\n\r\n            try {\r\n                const data = JSON.parse(responseText);\r\n                console.log(`[ApiService] Parsed response:`, data);\r\n                return data;\r\n            } catch (error) {\r\n                console.error(`[ApiService] Error parsing JSON:`, error);\r\n                // Si el parseo falla, pero la respuesta fue exitosa (ej. 204 No Content),\r\n                // podríamos devolver un objeto vacío o el texto plano si es necesario.\r\n                return { success: true, data: responseText };\r\n            }\r\n        } catch (error: any) {\r\n            console.error(`[ApiService] Fetch error:`, error);\r\n            throw error;\r\n        }\r\n    } static async startChat(userId: string, categories: string[] = []) {\r\n        return this.fetchApi('/chat/start', {\r\n            method: 'POST',\r\n            body: JSON.stringify({ userId, categories }),\r\n        });\r\n    }\r\n\r\n    static async sendMessage(chatId: string, text: string, userId: string) {\r\n        return this.fetchApi('/chat/message', {\r\n            method: 'POST',\r\n            body: JSON.stringify({ chatId, text, userId }),\r\n        });\r\n    }\r\n\r\n    static async completeChat(chatId: string) {\r\n        return this.fetchApi('/chat/complete', {\r\n            method: 'POST',\r\n            body: JSON.stringify({ chatId }),\r\n        });\r\n    }\r\n\r\n    static async getChats(userId?: string) {\r\n        const qs = userId ? `?userId=${encodeURIComponent(userId)}` : '';\r\n        return this.fetchApi(`/chat${qs}`, {\r\n            method: 'GET'\r\n        });\r\n    }\r\n\r\n    static async getChat(chatId: string) {\r\n        if (!chatId) throw new Error('chatId required');\r\n        return this.fetchApi(`/chat/${encodeURIComponent(chatId)}`, {\r\n            method: 'GET'\r\n        });\r\n    }\r\n\r\n    static async sendToExternal(chatId: string, webhookUrl?: string) {\r\n        return this.fetchApi('/chat/send-external', {\r\n            method: 'POST',\r\n            body: JSON.stringify({ chatId, webhookUrl }),\r\n        });\r\n    }\r\n\r\n    static async generatePlan(brief: TravelBrief, userLocation: GeolocationPosition | null) {\r\n        return this.fetchApi('/chat/generate-plan', {\r\n            method: 'POST',\r\n            body: JSON.stringify({ brief, userLocation }),\r\n        }) as Promise<TravelPlan>;\r\n    }\r\n}"],"names":[],"mappings":";;;AACA;;AAEO,MAAM;IACT,aAAqB,SAAS,QAAgB,EAAE,UAAuB,CAAC,CAAC,EAAE;QACvE,MAAM,MAAM,GAAG,iIAAA,CAAA,UAAO,GAAG,UAAU;QACnC,IAAI;YACA,QAAQ,GAAG,CAAC,CAAC,sBAAsB,EAAE,KAAK,EAAE;gBAAE,QAAQ,QAAQ,MAAM;YAAC;YAErE,MAAM,WAAW,MAAM,MAAM,KAAK;gBAC9B,GAAG,OAAO;gBACV,SAAS;oBACL,gBAAgB;oBAChB,GAAG,QAAQ,OAAO;gBACtB;YACJ;YAEA,QAAQ,GAAG,CAAC,CAAC,4CAA4C,EAAE,SAAS,MAAM,EAAE;YAE5E,IAAI,CAAC,SAAS,EAAE,EAAE;gBACd,MAAM,YAAY,MAAM,SAAS,IAAI;gBACrC,QAAQ,KAAK,CAAC,CAAC,wBAAwB,EAAE,SAAS,MAAM,EAAE,EAAE;gBAC5D,MAAM,IAAI,MAAM,CAAC,WAAW,EAAE,SAAS,MAAM,CAAC,GAAG,EAAE,WAAW;YAClE;YAEA,MAAM,eAAe,MAAM,SAAS,IAAI;YACxC,QAAQ,GAAG,CAAC,CAAC,+BAA+B,CAAC,EAAE;YAE/C,IAAI;gBACA,MAAM,OAAO,KAAK,KAAK,CAAC;gBACxB,QAAQ,GAAG,CAAC,CAAC,6BAA6B,CAAC,EAAE;gBAC7C,OAAO;YACX,EAAE,OAAO,OAAO;gBACZ,QAAQ,KAAK,CAAC,CAAC,gCAAgC,CAAC,EAAE;gBAClD,0EAA0E;gBAC1E,uEAAuE;gBACvE,OAAO;oBAAE,SAAS;oBAAM,MAAM;gBAAa;YAC/C;QACJ,EAAE,OAAO,OAAY;YACjB,QAAQ,KAAK,CAAC,CAAC,yBAAyB,CAAC,EAAE;YAC3C,MAAM;QACV;IACJ;IAAE,aAAa,UAAU,MAAc,EAAE,aAAuB,EAAE,EAAE;QAChE,OAAO,IAAI,CAAC,QAAQ,CAAC,eAAe;YAChC,QAAQ;YACR,MAAM,KAAK,SAAS,CAAC;gBAAE;gBAAQ;YAAW;QAC9C;IACJ;IAEA,aAAa,YAAY,MAAc,EAAE,IAAY,EAAE,MAAc,EAAE;QACnE,OAAO,IAAI,CAAC,QAAQ,CAAC,iBAAiB;YAClC,QAAQ;YACR,MAAM,KAAK,SAAS,CAAC;gBAAE;gBAAQ;gBAAM;YAAO;QAChD;IACJ;IAEA,aAAa,aAAa,MAAc,EAAE;QACtC,OAAO,IAAI,CAAC,QAAQ,CAAC,kBAAkB;YACnC,QAAQ;YACR,MAAM,KAAK,SAAS,CAAC;gBAAE;YAAO;QAClC;IACJ;IAEA,aAAa,SAAS,MAAe,EAAE;QACnC,MAAM,KAAK,SAAS,CAAC,QAAQ,EAAE,mBAAmB,SAAS,GAAG;QAC9D,OAAO,IAAI,CAAC,QAAQ,CAAC,CAAC,KAAK,EAAE,IAAI,EAAE;YAC/B,QAAQ;QACZ;IACJ;IAEA,aAAa,QAAQ,MAAc,EAAE;QACjC,IAAI,CAAC,QAAQ,MAAM,IAAI,MAAM;QAC7B,OAAO,IAAI,CAAC,QAAQ,CAAC,CAAC,MAAM,EAAE,mBAAmB,SAAS,EAAE;YACxD,QAAQ;QACZ;IACJ;IAEA,aAAa,eAAe,MAAc,EAAE,UAAmB,EAAE;QAC7D,OAAO,IAAI,CAAC,QAAQ,CAAC,uBAAuB;YACxC,QAAQ;YACR,MAAM,KAAK,SAAS,CAAC;gBAAE;gBAAQ;YAAW;QAC9C;IACJ;IAEA,aAAa,aAAa,KAAkB,EAAE,YAAwC,EAAE;QACpF,OAAO,IAAI,CAAC,QAAQ,CAAC,uBAAuB;YACxC,QAAQ;YACR,MAAM,KAAK,SAAS,CAAC;gBAAE;gBAAO;YAAa;QAC/C;IACJ;AACJ","debugId":null}},
    {"offset": {"line": 150, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/dibuj/Documents/Voaya/client/src/components/chat/chat-view.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport React, { useState, useEffect, useRef, useCallback } from 'react';\r\nimport { ChatMessage, TravelBrief } from '@/types';\r\nimport { ApiService } from '@/services/api';\r\nimport { ChatHeader } from './chat-header';\r\nimport { ChatMessages } from './chat-messages';\r\nimport { ChatInput } from './chat-input';\r\nimport { ChatCompletionControls } from './chat-completion-controls';\r\nimport { getUserIdFromCookie, getChatIdFromCookie, saveChatIdToCookie } from '@/lib/cookies';\r\n\r\ntype SearchCategory = 'flights' | 'hotels' | 'experiences';\r\n\r\ninterface ChatViewProps {\r\n  onChatComplete: (brief: TravelBrief) => void;\r\n  error: string | null;\r\n  initialQuery?: string;\r\n  selectedCategories?: Set<SearchCategory>;\r\n  userId?: string;\r\n  chatId?: string;\r\n  initialMessages?: ChatMessage[];\r\n  initialStatus?: string;\r\n}\r\n\r\nconst ChatView: React.FC<ChatViewProps> = ({ onChatComplete, error, initialQuery, selectedCategories, initialMessages, initialStatus }) => {\r\n  const [messages, setMessages] = useState<ChatMessage[]>(() => initialMessages || []);\r\n  const [input, setInput] = useState('');\r\n  const [isLoading, setIsLoading] = useState(false);\r\n  const [isChatComplete, setIsChatComplete] = useState(!!initialStatus && initialStatus === 'completed');\r\n  const [internalInitialQuery, setInternalInitialQuery] = useState(initialQuery || '');\r\n  const messagesEndRef = useRef<HTMLDivElement>(null);\r\n  const initialMessageSent = useRef(false);\r\n\r\n  // Get userId and chatId from cookies\r\n  const userId = getUserIdFromCookie();\r\n  const chatId = getChatIdFromCookie();\r\n\r\n  // Log initial status for debugging and detect if chat should show completion buttons\r\n  useEffect(() => {\r\n    console.log('[ChatView] Initialized with initialStatus:', initialStatus);\r\n    console.log('[ChatView] Initial messages count:', messages.length);\r\n    \r\n    // Show completion buttons if:\r\n    // 1. Status is 'completed' or 'finished', OR\r\n    // 2. Status is 'active' and there are messages (chat has content)\r\n    const shouldShowComplete = \r\n      initialStatus && \r\n      (initialStatus === 'completed' || \r\n       initialStatus === 'finished' || \r\n       (initialStatus === 'active' && messages.length > 0));\r\n    \r\n    console.log('[ChatView] shouldShowComplete:', shouldShowComplete);\r\n    if (shouldShowComplete && !isChatComplete) {\r\n      setIsChatComplete(true);\r\n    }\r\n  }, [initialStatus, messages.length, isChatComplete]);\r\n\r\n  const sendMessage = useCallback(async (text: string) => {\r\n    console.log(`[ChatView] sendMessage called with: \"${text}\"`);\r\n    console.log(`[ChatView] userId: ${userId}, chatId: ${chatId}`);\r\n\r\n    if (!userId || !chatId) {\r\n      console.error('[ChatView] Missing userId or chatId from cookies');\r\n      setMessages(prev => [...prev, {\r\n        role: 'assistant',\r\n        text: \"Error: No se pudo identificar tu sesión. Por favor, inicia sesión de nuevo.\"\r\n      }]);\r\n      return;\r\n    }\r\n\r\n    setIsLoading(true);\r\n\r\n    try {\r\n      console.log(`[ChatView] Calling ApiService.sendMessage...`);\r\n      const response = await ApiService.sendMessage(chatId, text, userId);\r\n      console.log(`[ChatView] Received response from API:`, response);\r\n\r\n      if (!response.message || typeof response.message.text !== 'string') {\r\n        console.error('[ChatView] Invalid response structure:', response);\r\n        throw new Error('Invalid response structure from server');\r\n      }\r\n\r\n      const modelMessage: ChatMessage = {\r\n        role: 'assistant',\r\n        text: response.message.text\r\n      };\r\n\r\n      console.log(`[ChatView] Updating messages state with new message...`);\r\n      setMessages(prev => {\r\n        const newMessages = [...prev, modelMessage];\r\n        console.log(`[ChatView] New messages state:`, newMessages);\r\n        return newMessages;\r\n      });\r\n\r\n      // Check if chat should be marked as complete based on the assistant's message\r\n      if (modelMessage.text.includes(\"ya tengo una base muy sólida para empezar a buscar\")) {\r\n        console.log(`[ChatView] Chat completion detected from Gemini response.`);\r\n        setIsChatComplete(true);\r\n      }\r\n    } catch (err) {\r\n      console.error(`[ChatView] Error calling API:`, err);\r\n      setMessages(prev => [...prev, {\r\n        role: 'assistant',\r\n        text: \"Lo siento, estoy teniendo problemas para conectarme. Por favor, inténtalo de nuevo.\"\r\n      }]);\r\n    } finally {\r\n      console.log(`[ChatView] sendMessage finished.`);\r\n      setIsLoading(false);\r\n    }\r\n  }, [selectedCategories]);\r\n\r\n  const handleSubmit = async (e: React.FormEvent) => {\r\n    e.preventDefault();\r\n    if (!input.trim() || isLoading) return;\r\n\r\n    const userMessage: ChatMessage = {\r\n      role: 'user',\r\n      text: input\r\n    };\r\n\r\n    setMessages(prev => [...prev, userMessage]);\r\n    const currentInput = input;\r\n    setInput('');\r\n\r\n    if (!internalInitialQuery) {\r\n      setInternalInitialQuery(currentInput);\r\n    }\r\n\r\n    await sendMessage(currentInput);\r\n  };\r\n\r\n  useEffect(() => {\r\n    if (initialQuery && !initialMessageSent.current) {\r\n      const userMessage: ChatMessage = {\r\n        role: 'user',\r\n        text: initialQuery\r\n      };\r\n      setMessages([userMessage]);\r\n      setInternalInitialQuery(initialQuery);\r\n      sendMessage(initialQuery);\r\n      initialMessageSent.current = true;\r\n    }\r\n  }, [initialQuery, sendMessage]);\r\n\r\n  const handleConfirm = async () => {\r\n    // Mark chat as completed before redirecting\r\n    if (chatId) {\r\n      try {\r\n        console.log('[ChatView] Marking chat as completed...');\r\n        await ApiService.completeChat(chatId);\r\n        console.log('[ChatView] Chat marked as completed');\r\n      } catch (err) {\r\n        console.error('[ChatView] Error completing chat:', err);\r\n      }\r\n    }\r\n    // Reload the planner page\r\n    window.location.href = '/plan';\r\n  };\r\n\r\n  const handleRestart = () => {\r\n    setMessages([]);\r\n    setInput('');\r\n    setIsLoading(false);\r\n    setIsChatComplete(false);\r\n    setInternalInitialQuery('');\r\n  };\r\n\r\n  return (\r\n    <div className=\"container max-w-4xl mx-auto flex flex-col min-h-[700px] bg-gradient-to-b from-white to-gray-50/80 rounded-3xl shadow-xl overflow-hidden border border-gray-100/80\">\r\n      <div className=\"py-8 px-8 bg-white border-b border-gray-100/80\">\r\n        <div className=\"flex items-center justify-between\">\r\n          <div className=\"space-y-1\">\r\n            <h1 className=\"text-2xl font-semibold bg-gradient-to-r from-blue-600 to-indigo-600 bg-clip-text text-transparent\">\r\n              Tu próxima aventura te espera ✈️\r\n            </h1>\r\n            <p className=\"text-sm text-gray-500\">Charlemos sobre tu próximo viaje</p>\r\n          </div>\r\n          <div className=\"flex items-center gap-2 px-4 py-2 bg-gray-50 rounded-full border border-gray-100/80\">\r\n            <div className=\"w-2 h-2 rounded-full bg-green-400 animate-pulse\"></div>\r\n            <span className=\"text-sm text-gray-600 font-medium\">Voaya está activa</span>\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      {error && (\r\n        <div className=\"px-8 py-3 bg-red-50 border-b border-red-100 text-red-600 text-center text-sm font-medium\">\r\n          {error}\r\n        </div>\r\n      )}\r\n\r\n      <div className=\"flex-1 overflow-y-auto px-8 py-8 space-y-8\">\r\n        {messages.map((msg, index) => (\r\n          <div\r\n            key={index}\r\n            className={`flex items-end gap-4 ${msg.role === 'user' ? 'justify-end' : 'justify-start'} animate-slideIn`}\r\n          >\r\n            {msg.role === 'assistant' && (\r\n              <div className=\"w-12 h-12 rounded-full bg-gradient-to-br from-blue-600 to-indigo-600 flex items-center justify-center text-white font-bold text-lg shadow-inner flex-shrink-0 border-2 border-white\">\r\n                V\r\n              </div>\r\n            )}\r\n            <div\r\n              className={`\r\n                group max-w-[80%] px-6 py-4 rounded-2xl transition-all duration-200\r\n                ${msg.role === 'user'\r\n                  ? 'bg-gradient-to-r from-blue-600 to-indigo-600 text-white rounded-br-sm shadow-lg hover:shadow-xl hover:-translate-y-0.5'\r\n                  : 'bg-white text-gray-700 rounded-bl-sm shadow-md hover:shadow-lg hover:-translate-y-0.5 border border-gray-100'\r\n                }\r\n              `}\r\n            >\r\n              <p className=\"text-[15px] leading-relaxed whitespace-pre-wrap\">{msg.text}</p>\r\n            </div>\r\n          </div>\r\n        ))}\r\n\r\n        {isLoading && (\r\n          <div className=\"flex items-end gap-4 justify-start animate-slideIn\">\r\n            <div className=\"w-10 h-10 rounded-full bg-gradient-to-br from-blue-600 to-indigo-600 flex items-center justify-center text-white font-bold text-lg shadow-inner flex-shrink-0 border-2 border-white\">\r\n              V\r\n            </div>\r\n            <div className=\"max-w-[80%] px-5 py-4 rounded-2xl bg-white shadow-md border border-gray-100 rounded-bl-sm\">\r\n              <div className=\"flex items-center space-x-2\">\r\n                <div className=\"w-2.5 h-2.5 rounded-full bg-blue-500 animate-bounce\"></div>\r\n                <div className=\"w-2.5 h-2.5 rounded-full bg-blue-500 animate-bounce [animation-delay:0.2s]\"></div>\r\n                <div className=\"w-2.5 h-2.5 rounded-full bg-blue-500 animate-bounce [animation-delay:0.4s]\"></div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        )}\r\n        <div ref={messagesEndRef} />\r\n      </div>\r\n\r\n      <div className=\"p-8 bg-white border-t border-gray-100/80\">\r\n        {isChatComplete ? (\r\n          <div className=\"flex items-center justify-center gap-6\">\r\n            <button\r\n              onClick={handleRestart}\r\n              className=\"px-8 py-4 rounded-full bg-gray-50 text-gray-700 font-medium hover:bg-gray-100 transition-all duration-300 transform hover:-translate-y-0.5 focus:outline-none focus:ring-2 focus:ring-gray-200 focus:ring-offset-2 shadow-sm hover:shadow\"\r\n            >\r\n              Reiniciar Chat\r\n            </button>\r\n            <button\r\n              onClick={handleConfirm}\r\n              className=\"px-10 py-4 rounded-full bg-gradient-to-r from-blue-600 to-indigo-600 text-white font-medium hover:from-blue-700 hover:to-indigo-700 transition-all duration-300 transform hover:-translate-y-0.5 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 shadow-md hover:shadow-lg\"\r\n            >\r\n              Confirmar y Buscar\r\n            </button>\r\n          </div>\r\n        ) : (\r\n          <form onSubmit={handleSubmit} className=\"flex items-center gap-4\">\r\n            <div className=\"relative flex-1\">\r\n              <input\r\n                type=\"text\"\r\n                value={input}\r\n                onChange={(e) => setInput(e.target.value)}\r\n                placeholder=\"Ej.: París, 2 personas, mayo...\"\r\n                className=\"w-full px-6 py-4 bg-gray-50 text-gray-800 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition-all duration-200 placeholder:text-gray-400 shadow-sm hover:shadow-md\"\r\n                disabled={isLoading}\r\n              />\r\n            </div>\r\n            <button\r\n              type=\"submit\"\r\n              disabled={isLoading || !input.trim()}\r\n              className=\"p-4 rounded-xl bg-gradient-to-r from-blue-600 to-indigo-600 text-white hover:from-blue-700 hover:to-indigo-700 disabled:from-gray-300 disabled:to-gray-300 disabled:cursor-not-allowed transition-all duration-300 transform hover:-translate-y-0.5 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 shadow-md hover:shadow-lg\"\r\n            >\r\n              <svg xmlns=\"http://www.w3.org/2000/svg\" className=\"h-6 w-6\" viewBox=\"0 0 20 20\" fill=\"currentColor\">\r\n                <path d=\"M10.894 2.553a1 1 0 00-1.788 0l-7 14a1 1 0 001.169 1.409l5-1.429A1 1 0 009 15.571V11a1 1 0 112 0v4.571a1 1 0 00.725.962l5 1.428a1 1 0 001.17-1.408l-7-14z\" />\r\n              </svg>\r\n            </button>\r\n          </form>\r\n        )}\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default ChatView;\r\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 609, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/dibuj/Documents/Voaya/client/src/app/chats/%5BchatId%5D/page.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport React, { useEffect, useState } from 'react';\r\nimport { useParams, useRouter } from 'next/navigation';\r\nimport ChatView from '@/components/chat/chat-view';\r\nimport { ApiService } from '@/services/api';\r\nimport { getUserIdFromCookie, saveChatIdToCookie } from '@/lib/cookies';\r\nimport { ChatMessage, TravelBrief } from '@/types';\r\n\r\nexport default function ChatPage() {\r\n  const params = useParams() as { chatId?: string };\r\n  const router = useRouter();\r\n  const chatId = params?.chatId;\r\n\r\n  const [loading, setLoading] = useState(true);\r\n  const [error, setError] = useState<string | null>(null);\r\n  const [messages, setMessages] = useState<ChatMessage[]>([]);\r\n  const [chatStatus, setChatStatus] = useState<string | undefined>(undefined);\r\n\r\n  useEffect(() => {\r\n    if (!chatId) {\r\n      router.push('/chats');\r\n      return;\r\n    }\r\n\r\n    // Save chatId to cookie so ChatView and other parts can use it\r\n    saveChatIdToCookie(chatId);\r\n\r\n    const load = async () => {\r\n      setLoading(true);\r\n      try {\r\n        const res: any = await ApiService.getChat(chatId);\r\n        console.log('[ChatPage] Loaded chat data:', res?.chat);\r\n        console.log('[ChatPage] Chat status:', res?.chat?.status);\r\n        console.log('[ChatPage] Number of messages:', res?.messages?.length);\r\n        setMessages(res?.messages || []);\r\n        setChatStatus(res?.chat?.status);\r\n      } catch (err: any) {\r\n        console.error('Failed to load chat', err);\r\n        setError(err?.message || 'Error cargando chat');\r\n      } finally {\r\n        setLoading(false);\r\n      }\r\n    };\r\n\r\n    load();\r\n  }, [chatId, router]);\r\n\r\n  const handleChatComplete = async (brief: TravelBrief) => {\r\n    try {\r\n      await ApiService.completeChat(chatId || '');\r\n      setChatStatus('completed');\r\n    } catch (err) {\r\n      console.error('Failed to complete chat', err);\r\n    }\r\n  };\r\n\r\n  if (loading) {\r\n    return <div className=\"flex items-center justify-center min-h-screen\">Cargando chat…</div>;\r\n  }\r\n\r\n  if (error) {\r\n    return <div className=\"p-8 text-red-600\">{error}</div>;\r\n  }\r\n\r\n  return (\r\n    <div className=\"py-8 md:py-12 min-h-screen bg-gray-50/50\">\r\n      <ChatView\r\n        onChatComplete={handleChatComplete}\r\n        error={null}\r\n        initialMessages={messages}\r\n        initialStatus={chatStatus}\r\n        userId={getUserIdFromCookie() || undefined}\r\n        chatId={chatId}\r\n      />\r\n    </div>\r\n  );\r\n}\r\n"],"names":[],"mappings":";;;;AAEA;AACA;AACA;AACA;AACA;;;AANA;;;;;;AASe,SAAS;;IACtB,MAAM,SAAS,CAAA,GAAA,qIAAA,CAAA,YAAS,AAAD;IACvB,MAAM,SAAS,CAAA,GAAA,qIAAA,CAAA,YAAS,AAAD;IACvB,MAAM,SAAS,QAAQ;IAEvB,MAAM,CAAC,SAAS,WAAW,GAAG,CAAA,GAAA,6JAAA,CAAA,WAAQ,AAAD,EAAE;IACvC,MAAM,CAAC,OAAO,SAAS,GAAG,CAAA,GAAA,6JAAA,CAAA,WAAQ,AAAD,EAAiB;IAClD,MAAM,CAAC,UAAU,YAAY,GAAG,CAAA,GAAA,6JAAA,CAAA,WAAQ,AAAD,EAAiB,EAAE;IAC1D,MAAM,CAAC,YAAY,cAAc,GAAG,CAAA,GAAA,6JAAA,CAAA,WAAQ,AAAD,EAAsB;IAEjE,CAAA,GAAA,6JAAA,CAAA,YAAS,AAAD;8BAAE;YACR,IAAI,CAAC,QAAQ;gBACX,OAAO,IAAI,CAAC;gBACZ;YACF;YAEA,+DAA+D;YAC/D,CAAA,GAAA,kIAAA,CAAA,qBAAkB,AAAD,EAAE;YAEnB,MAAM;2CAAO;oBACX,WAAW;oBACX,IAAI;wBACF,MAAM,MAAW,MAAM,mIAAA,CAAA,aAAU,CAAC,OAAO,CAAC;wBAC1C,QAAQ,GAAG,CAAC,gCAAgC,KAAK;wBACjD,QAAQ,GAAG,CAAC,2BAA2B,KAAK,MAAM;wBAClD,QAAQ,GAAG,CAAC,kCAAkC,KAAK,UAAU;wBAC7D,YAAY,KAAK,YAAY,EAAE;wBAC/B,cAAc,KAAK,MAAM;oBAC3B,EAAE,OAAO,KAAU;wBACjB,QAAQ,KAAK,CAAC,uBAAuB;wBACrC,SAAS,KAAK,WAAW;oBAC3B,SAAU;wBACR,WAAW;oBACb;gBACF;;YAEA;QACF;6BAAG;QAAC;QAAQ;KAAO;IAEnB,MAAM,qBAAqB,OAAO;QAChC,IAAI;YACF,MAAM,mIAAA,CAAA,aAAU,CAAC,YAAY,CAAC,UAAU;YACxC,cAAc;QAChB,EAAE,OAAO,KAAK;YACZ,QAAQ,KAAK,CAAC,2BAA2B;QAC3C;IACF;IAEA,IAAI,SAAS;QACX,qBAAO,6LAAC;YAAI,WAAU;sBAAgD;;;;;;IACxE;IAEA,IAAI,OAAO;QACT,qBAAO,6LAAC;YAAI,WAAU;sBAAoB;;;;;;IAC5C;IAEA,qBACE,6LAAC;QAAI,WAAU;kBACb,cAAA,6LAAC,uJAAA,CAAA,UAAQ;YACP,gBAAgB;YAChB,OAAO;YACP,iBAAiB;YACjB,eAAe;YACf,QAAQ,CAAA,GAAA,kIAAA,CAAA,sBAAmB,AAAD,OAAO;YACjC,QAAQ;;;;;;;;;;;AAIhB;GApEwB;;QACP,qIAAA,CAAA,YAAS;QACT,qIAAA,CAAA,YAAS;;;KAFF","debugId":null}},
    {"offset": {"line": 732, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/dibuj/Documents/Voaya/node_modules/next/navigation.js"],"sourcesContent":["module.exports = require('./dist/client/components/navigation')\n"],"names":[],"mappings":"AAAA,OAAO,OAAO","ignoreList":[0],"debugId":null}}]
}