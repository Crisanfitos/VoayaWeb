{
  "entities": {
    "UserProfile": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "UserProfile",
      "type": "object",
      "description": "Represents a user profile within the Voaya application.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the user profile."
        },
        "email": {
          "type": "string",
          "description": "User's email address.",
          "format": "email"
        },
        "firstName": {
          "type": "string",
          "description": "User's first name."
        },
        "lastName": {
          "type": "string",
          "description": "User's last name."
        },
        "dateJoined": {
          "type": "string",
          "description": "Date when the user joined the platform.",
          "format": "date-time"
        },
        "lastLogin": {
          "type": "string",
          "description": "Date of the user's last login.",
          "format": "date-time"
        },
        "preferredCurrency": {
          "type": "string",
          "description": "Preferred currency for transactions (e.g., USD, EUR)."
        },
        "profilePicture": {
          "type": "string",
          "description": "URL to the user's profile picture.",
          "format": "uri"
        }
      },
      "required": [
        "id",
        "email",
        "firstName",
        "lastName",
        "dateJoined"
      ]
    },
    "Chat": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Chat",
      "type": "object",
      "description": "Represents a single chat conversation for travel planning.",
      "properties": {
        "userId": {
          "type": "string",
          "description": "The UID of the user who owns this chat."
        },
        "createdAt": {
          "type": "string",
          "description": "Timestamp when the chat was created.",
          "format": "date-time"
        },
        "title": {
          "type": "string",
          "description": "A short title for the chat, derived from the first user message."
        }
      },
      "required": ["userId", "createdAt", "title"]
    },
    "Message": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Message",
      "type": "object",
      "description": "Represents a single message within a chat.",
      "properties": {
        "role": {
          "type": "string",
          "description": "The role of the sender.",
          "enum": ["user", "assistant"]
        },
        "text": {
          "type": "string",
          "description": "The text content of the message."
        },
        "createdAt": {
          "type": "string",
          "description": "Timestamp when the message was sent.",
          "format": "date-time"
        }
      },
      "required": ["role", "text", "createdAt"]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "UserProfile",
          "schema": {
            "$ref": "#/backend/entities/UserProfile"
          },
          "description": "Stores user profile information. The userId path parameter ensures that only the authenticated user can access their own profile data.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user."
            }
          ]
        }
      },
      {
        "path": "/chats/{chatId}",
        "definition": {
          "entityName": "Chat",
          "schema": {
            "$ref": "#/backend/entities/Chat"
          },
          "description": "Stores the top-level document for a chat session.",
          "params": [
            {
              "name": "chatId",
              "description": "The unique identifier of the chat."
            }
          ]
        }
      },
       {
        "path": "/chats/{chatId}/messages/{messageId}",
        "definition": {
          "entityName": "Message",
          "schema": {
            "$ref": "#/backend/entities/Message"
          },
          "description": "Stores the individual messages within a specific chat session.",
          "params": [
            {
              "name": "chatId",
              "description": "The unique identifier of the parent chat."
            },
            {
              "name": "messageId",
              "description": "The unique identifier of the message."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore structure is designed to manage user profiles with a focus on scalability, security, and ease of maintenance. It leverages path-based ownership for user profiles to ensure that only the authenticated user can access their profile data. This approach simplifies security rules and eliminates the need for complex authorization logic. This approach is secure and makes ownership-based security rules simple and efficient."
  }
}
